{% extends "base.html" %}
{% load i18n %}

{% block title %}مدیریت موجودی منو - ۳۶{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
    <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-8 md:mb-10">
        <h1 class="text-3xl md:text-4xl font-black text-white">مدیریت موجودی</h1>
        <a href="{% url 'cafe:barista_dashboard' %}" class="btn-apple-glass">بازگشت به داشبورد</a>
    </div>

    <div class="material-glass glass-sheen hover-lift border border-white/10 rounded-3xl p-6 mb-8 fade-in-once">
        <h2 class="text-lg font-black text-white mb-4">افزودن آیتم جدید</h2>
        <form method="post" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {% csrf_token %}
            <input type="hidden" name="action" value="create_item">

            <div class="md:col-span-2">
                <label class="label"><span class="label-text text-white/70 font-bold">نام آیتم</span></label>
                <input name="name" type="text" class="input-apple rounded-2xl" placeholder="مثال: کاپوچینو" required>
            </div>

            <div>
                <label class="label"><span class="label-text text-white/70 font-bold">قیمت (تومان)</span></label>
                <input name="price" type="number" min="0" class="input-apple rounded-2xl" placeholder="مثال: 150000" required>
            </div>

            <div>
                <label class="label"><span class="label-text text-white/70 font-bold">دسته‌بندی موجود</span></label>
                <select name="category_id" class="w-full h-12 px-4 rounded-2xl glass-inset text-white focus:bg-white/10 focus:outline-none">
                    <option value="">انتخاب کنید</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" class="text-black">{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label class="label"><span class="label-text text-white/70 font-bold">یا ایجاد دسته‌بندی جدید</span></label>
                <input name="new_category" type="text" class="input-apple rounded-2xl" placeholder="مثال: نوشیدنی سرد">
            </div>

            <div class="md:col-span-2">
                <label class="label"><span class="label-text text-white/70 font-bold">توضیحات (اختیاری)</span></label>
                <textarea name="description" class="w-full min-h-[96px] glass-inset rounded-2xl p-3 text-white placeholder-white/30 focus:outline-none focus:ring-0" placeholder="توضیح کوتاه آیتم"></textarea>
            </div>

            <label class="flex items-center gap-2 text-sm font-bold text-white/70">
                <input type="checkbox" name="is_available" class="toggle toggle-accent" checked>
                موجود باشد
            </label>

            <div class="md:col-span-2">
                <button type="submit" class="btn-apple-primary w-full">افزودن آیتم</button>
            </div>
        </form>
    </div>

    <div class="material-glass glass-sheen hover-lift border border-white/10 rounded-3xl overflow-hidden fade-in-once">
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead class="glass-header text-white/70">
                    <tr>
                        <th class="px-4 py-4 text-right font-bold">آیتم</th>
                        <th class="px-4 py-4 text-right font-bold">دسته‌بندی</th>
                        <th class="px-4 py-4 text-left font-bold">وضعیت موجودی</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/5">
                    {% for item in items %}
                        <tr class="hover:bg-white/5 transition-colors">
                            <td class="px-4 py-4"><span class="font-bold text-white">{{ item.name }}</span></td>
                            <td class="px-4 py-4">
                                <span class="px-3 py-1 rounded-full text-[11px] font-black glass-chip text-white/70">
                                    {{ item.category.name }}
                                </span>
                            </td>
                            <td class="px-4 py-4 text-left">
                                <form method="post" class="inline">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="toggle">
                                    <input type="hidden" name="item_id" value="{{ item.id }}">
                                    <button type="submit"
                                            class="px-4 py-1.5 rounded-full text-xs font-black transition-all border
                                                   {% if item.is_available %}
                                                   bg-emerald-400/20 text-emerald-200 border-emerald-400/30 hover:bg-emerald-400/30
                                                   {% else %}
                                                   bg-rose-400/20 text-rose-200 border-rose-400/30 hover:bg-rose-400/30
                                                   {% endif %}">
                                        {% if item.is_available %}موجود{% else %}ناموجود{% endif %}
                                    </button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
