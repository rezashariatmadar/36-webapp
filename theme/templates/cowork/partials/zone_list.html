{% if has_spaces %}
<div class="join join-vertical w-full glass-panel shadow-2xl rounded-3xl border border-white/10 animate-in fade-in duration-500 text-white">
    {% for zone in zones_with_spaces %}
        {% if zone.spaces %}
        <div class="collapse collapse-arrow join-item border-white/5 group">
            <input type="radio" name="zone-accordion" id="zone-{{ forloop.counter }}" {% if forloop.first %}checked="checked"{% endif %} /> 
            <label class="collapse-title text-xl font-black flex items-center gap-4 py-6 cursor-pointer" for="zone-{{ forloop.counter }}">
                <div class="w-2 h-8 bg-accent rounded-full group-hover:h-12 transition-all duration-300"></div>
                {{ zone.label }}
                <span class="badge badge-ghost glass-panel badge-sm opacity-50 text-white">{{ zone.spaces|length }} Ù…ÙˆØ±Ø¯</span>
            </label>
            <div class="collapse-content"> 
                <div class="py-6 px-4">
                    {% if zone.code == 'SHARED_DESK' %}
                        <!-- Nested Accordion for Shared Tables (Seat-by-Seat) -->
                        <div class="join join-vertical w-full border border-white/10 rounded-2xl overflow-hidden shadow-sm">
                            {% for parent in zone.spaces %}
                                <div class="collapse collapse-plus join-item border-b border-white/5 glass-header">
                                    <input type="checkbox" name="parent-accordion" id="parent-{{ parent.id }}" /> 
                                    <label class="collapse-title text-lg font-bold flex justify-between items-center px-6 py-4 cursor-pointer" for="parent-{{ parent.id }}">
                                        <span>{{ parent.name }}</span>
                                        <div class="flex items-center gap-2">
                                            <span class="badge badge-ghost glass-panel badge-sm text-white">{{ parent.capacity }} Ù†ÙØ±Ù‡</span>
                                            <span class="badge badge-accent badge-sm font-black">{{ parent.seats.all|length }} ØµÙ†Ø¯Ù„ÛŒ</span>
                                        </div>
                                    </label>
                                    <div class="collapse-content px-6 bg-black/20">
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 py-6">
                                            {% for seat in parent.seats.all %}
                                                <div class="card glass-panel shadow-sm p-4 flex flex-col items-center gap-3 hover:bg-white/10 transition-colors">
                                                    <span class="font-bold text-sm">{{ seat.name }}</span>
                                                    {% if seat.status == 'AVAILABLE' %}
                                                        <a href="{% url 'cowork:book_space' seat.id %}" class="btn btn-accent btn-sm w-full font-black">Ø±Ø²Ø±Ùˆ ØµÙ†Ø¯Ù„ÛŒ</a>
                                                    {% elif seat.status == 'OCCUPIED' %}
                                                        <button class="btn btn-disabled btn-sm w-full opacity-30 text-white">Ø±Ø²Ø±Ùˆ Ø´Ø¯Ù‡</button>
                                                    {% else %}
                                                        <button class="btn btn-disabled btn-sm w-full opacity-30 text-white">ØºÛŒØ±ÙØ¹Ø§Ù„</button>
                                                    {% endif %}
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% elif zone.code == 'PRIVATE_2' or zone.code == 'PRIVATE_3' %}
                        <!-- VIP Rooms (Book Whole Room - No Seats) -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-in fade-in slide-in-from-top-4 duration-500">
                            {% for room in zone.spaces %}
                                <div class="card glass-panel glass-sheen hover-lift shadow-2xl rounded-3xl hover:bg-white/5 transition-all group overflow-hidden border border-white/10" data-rb-island="spotlight-card">
                                    <div class="h-2 
                                        {% if room.status == 'AVAILABLE' %}bg-accent/40 group-hover:bg-accent
                                        {% elif room.status == 'OCCUPIED' %}bg-error/40 group-hover:bg-error
                                        {% else %}bg-white/10{% endif %} transition-colors"></div>
                                    <div class="card-body p-6">
                                        <div class="flex justify-between items-center mb-4">
                                            <h3 class="text-lg font-black text-white">{{ room.name }}</h3>
                                            {% if room.status == 'AVAILABLE' %}
                                                <span class="badge badge-accent badge-sm font-black border-none">Ø¢Ø²Ø§Ø¯</span>
                                            {% elif room.status == 'OCCUPIED' %}
                                                <span class="badge badge-error badge-sm text-white border-none font-bold">Ø±Ø²Ø±Ùˆ Ø´Ø¯Ù‡</span>
                                            {% else %}
                                                <span class="badge glass-panel badge-sm text-white/50 border-white/10">Ø®Ø§Ø±Ø¬ Ø§Ø² Ø³Ø±ÙˆÛŒØ³</span>
                                            {% endif %}
                                        </div>
                                        
                                        <div class="space-y-2 mb-6 glass-inset p-4 rounded-2xl">
                                            <div class="flex justify-between text-xs opacity-70">
                                                <span>Ù…Ø§Ù‡Ø§Ù†Ù‡:</span>
                                                <span class="font-bold">{{ room.pricing_plan.monthly_rate }} ØªÙˆÙ…Ø§Ù†</span>
                                            </div>
                                            <div class="flex justify-between text-xs text-secondary font-bold">
                                                <span>Û¶ Ù…Ø§Ù‡Ù‡:</span>
                                                <span>{{ room.pricing_plan.six_month_rate }} ØªÙˆÙ…Ø§Ù†</span>
                                            </div>
                                            <div class="flex justify-between text-sm text-accent font-black pt-1 border-t border-white/10">
                                                <span>Ø³Ø§Ù„Ø§Ù†Ù‡:</span>
                                                <span>{{ room.pricing_plan.yearly_rate }} ØªÙˆÙ…Ø§Ù†</span>
                                            </div>
                                        </div>

                                        <div class="card-actions">
                                            {% if room.status == 'AVAILABLE' %}
                                                <a href="{% url 'cowork:book_space' room.id %}" class="btn btn-accent btn-sm w-full font-black shadow-lg shadow-accent/20">Ø±Ø²Ø±Ùˆ Ø§ØªØ§Ù‚</a>
                                            {% else %}
                                                <button class="btn btn-disabled btn-sm w-full font-black opacity-30 text-white">ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø±Ø²Ø±Ùˆ</button>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <!-- Regular Grid for other zones (e.g. Desks, Long Table) -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 animate-in fade-in slide-in-from-top-4 duration-500">
                            {% for space in zone.spaces %}
                                <div class="card glass-panel glass-sheen hover-lift shadow-2xl rounded-3xl hover:bg-white/5 transition-all group overflow-hidden border border-white/10" data-rb-island="spotlight-card">
                                    <div class="h-2 
                                        {% if space.status == 'AVAILABLE' %}bg-accent/40 group-hover:bg-accent
                                        {% elif space.status == 'OCCUPIED' %}bg-error/40 group-hover:bg-error
                                        {% else %}bg-white/10{% endif %} transition-colors"></div>
                                    <div class="card-body p-6">
                                        <div class="flex justify-between items-start mb-4">
                                            <div>
                                                <h2 class="card-title text-xl font-black mb-1 text-white">{{ space.name }}</h2>
                                            </div>
                                            <div class="flex items-center gap-1 text-xs font-bold opacity-50 text-white">
                                                {{ space.capacity }} Ù†ÙØ±Ù‡
                                            </div>
                                        </div>
                                        
                                        <div class="space-y-3 mb-8 glass-inset p-4 rounded-2xl min-h-[100px] flex flex-col justify-center">
                                            {% if space.status == 'OCCUPIED' %}
                                                <div class="text-center py-2">
                                                    <span class="text-error font-black text-sm">Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø±Ø²Ø±Ùˆ Ø´Ø¯Ù‡ Ø§Ø³Øª</span>
                                                </div>
                                            {% elif not space.pricing_plan %}
                                                <div class="text-center py-2">
                                                    <span class="text-warning font-black text-sm">Ø·Ø±Ø­ Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ ØªØ¹ÛŒÛŒÙ† Ù†Ø´Ø¯Ù‡</span>
                                                </div>
                                            {% elif space.pricing_plan.is_contact_for_price %}
                                                <div class="text-center py-2">
                                                    <span class="text-accent font-black">Ø¨Ø±Ø§ÛŒ Ù‚ÛŒÙ…Øª ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯</span>
                                                </div>
                                            {% else %}
                                                {% if space.pricing_plan.daily_rate > 0 %}
                                                    <div class="flex justify-between items-center text-sm text-white/80">
                                                        <span class="opacity-70">Ø±ÙˆØ²Ø§Ù†Ù‡</span>
                                                        <span class="font-bold">{{ space.pricing_plan.daily_rate }} ØªÙˆÙ…Ø§Ù†</span>
                                                    </div>
                                                {% endif %}
                                                {% if space.pricing_plan.monthly_rate > 0 %}
                                                    <div class="flex justify-between items-center text-sm text-white/80">
                                                        <span class="opacity-70">Ù…Ø§Ù‡Ø§Ù†Ù‡</span>
                                                        <span class="font-bold text-secondary">{{ space.pricing_plan.monthly_rate }} ØªÙˆÙ…Ø§Ù†</span>
                                                    </div>
                                                {% endif %}
                                                {% if space.pricing_plan.yearly_rate > 0 %}
                                                    <div class="flex justify-between items-center text-sm border-t border-white/10 pt-2 mt-2 text-white">
                                                        <span class="opacity-70">Ø³Ø§Ù„Ø§Ù†Ù‡</span>
                                                        <span class="font-black text-accent">{{ space.pricing_plan.yearly_rate }} ØªÙˆÙ…Ø§Ù†</span>
                                                    </div>
                                                {% endif %}
                                            {% endif %}
                                        </div>

                                        <div class="card-actions">
                                            {% if space.status == 'AVAILABLE' %}
                                                <a href="{% url 'cowork:book_space' space.id %}" class="btn btn-accent w-full font-black shadow-lg shadow-accent/20">
                                                    Ø±Ø²Ø±Ùˆ Ø¢Ù†Ù„Ø§ÛŒÙ†
                                                </a>
                                            {% else %}
                                                <button class="btn btn-disabled w-full font-black opacity-30 text-white">ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø±Ø²Ø±Ùˆ</button>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        {% endfor %}
    </div>
{% else %}
    {% include "components/empty_state.html" with title="ÙØ¶Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯" description="Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† ÙØ¶Ø§ÛŒ ÙØ¹Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø±Ø²Ø±Ùˆ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª." icon_emoji="ğŸª‘" primary_cta_text="Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø®Ø§Ù†Ù‡" primary_cta_url="/" %}
{% endif %}
