import{b as o}from"./chunk-3ESRGU4J.js";import{b as p,c as P,d as O}from"./chunk-DZ4QUUKD.js";var s=p(P());var t=p(O());function L({me:n}){let[b,S]=(0,s.useState)([]),[c,l]=(0,s.useState)({items:[],total:0,cart_count:0}),[h,v]=(0,s.useState)([]),[f,y]=(0,s.useState)(""),[m,d]=(0,s.useState)(!1),[N,i]=(0,s.useState)(""),[w,r]=(0,s.useState)(""),x=async()=>{let e=await o("/api/cafe/cart/");l(e)},T=async()=>{let e=await o("/api/cafe/menu/");S(e.categories||[])},g=async()=>{if(!n.authenticated){v([]);return}let e=await o("/api/cafe/orders/");v(e.orders||[])},C=async()=>{d(!0),i("");try{await Promise.all([T(),x(),g()])}catch(e){i(e.message)}finally{d(!1)}};(0,s.useEffect)(()=>{C()},[n.authenticated]);let k=async(e,a)=>{i("");try{let u=await o("/api/cafe/cart/items/",{method:"POST",body:JSON.stringify({menu_item_id:e,delta:a})});l(u),r("Cart updated"),window.setTimeout(()=>r(""),1200)}catch(u){i(u.message)}},_=async()=>{if(!n.authenticated){window.location.assign(n.login_url||"/app/account");return}i(""),d(!0);try{await o("/api/cafe/checkout/",{method:"POST",body:JSON.stringify({notes:f})}),y(""),await Promise.all([x(),g()]),r("Checkout completed")}catch(e){i(e.message)}finally{d(!1)}},E=async e=>{i("");try{let a=await o(`/api/cafe/orders/${e}/reorder/`,{method:"POST"});l(a),r("Order copied to cart"),window.setTimeout(()=>r(""),1200)}catch(a){i(a.message)}};return(0,t.jsxs)("section",{className:"spa-grid spa-grid-2",children:[(0,t.jsxs)("div",{className:"spa-card p-5 md:p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"Cafe Menu"}),(0,t.jsx)("button",{type:"button",className:"btn btn-sm btn-outline border-white/30 text-white",onClick:C,disabled:m,children:"Refresh"})]}),N?(0,t.jsx)("div",{className:"alert alert-error mb-4",children:N}):null,w?(0,t.jsx)("div",{className:"alert alert-success mb-4",children:w}):null,m&&!b.length?(0,t.jsx)("div",{className:"text-white/60",children:"Loading..."}):null,(0,t.jsx)("div",{className:"space-y-5",children:b.map(e=>(0,t.jsxs)("article",{children:[(0,t.jsx)("h3",{className:"font-semibold text-white/90 mb-2",children:e.name}),(0,t.jsx)("div",{className:"spa-grid md:grid-cols-2",children:(e.items||[]).map(a=>(0,t.jsxs)("div",{className:"spa-card p-4",children:[(0,t.jsx)("div",{className:"font-medium",children:a.name}),(0,t.jsx)("div",{className:"text-sm text-white/60 mt-1",children:a.description||"No description"}),(0,t.jsxs)("div",{className:"mt-2 text-sm font-semibold",children:[a.price.toLocaleString()," toman"]}),(0,t.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,t.jsx)("button",{type:"button",className:"btn btn-xs btn-outline border-white/30 text-white",onClick:()=>k(a.id,-1),children:"-"}),(0,t.jsx)("button",{type:"button",className:"btn btn-xs btn-primary",onClick:()=>k(a.id,1),children:"Add"})]})]},a.id))})]},e.id))})]}),(0,t.jsxs)("aside",{className:"spa-grid",children:[(0,t.jsxs)("div",{className:"spa-card p-5",children:[(0,t.jsxs)("h2",{className:"text-lg font-bold",children:["Cart (",c.cart_count||0,")"]}),(0,t.jsx)("div",{className:"mt-3 space-y-2 max-h-80 overflow-auto pr-1",children:(c.items||[]).length?c.items.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsxs)("span",{children:[e.name," x ",e.quantity]}),(0,t.jsx)("span",{children:e.subtotal.toLocaleString()})]},`${e.item_id}-${e.quantity}`)):(0,t.jsx)("div",{className:"text-white/60 text-sm",children:"Cart is empty"})}),(0,t.jsxs)("div",{className:"mt-3 font-semibold",children:["Total: ",(c.total||0).toLocaleString()," toman"]}),(0,t.jsx)("textarea",{className:"textarea textarea-bordered w-full mt-3 bg-white/5 border-white/20 text-white",rows:3,value:f,onChange:e=>y(e.target.value),placeholder:"Order notes"}),(0,t.jsx)("button",{type:"button",className:"btn btn-primary w-full mt-3",onClick:_,disabled:m||!(c.items||[]).length,children:"Checkout"})]}),(0,t.jsxs)("div",{className:"spa-card p-5",children:[(0,t.jsx)("h2",{className:"text-lg font-bold",children:"My Orders"}),n.authenticated?(h||[]).length?(0,t.jsx)("div",{className:"mt-3 space-y-3",children:h.map(e=>(0,t.jsxs)("div",{className:"spa-card p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsxs)("span",{children:["Order #",e.id]}),(0,t.jsx)("span",{children:e.status})]}),(0,t.jsxs)("div",{className:"text-xs text-white/60 mt-1",children:["Total: ",(e.total_price||0).toLocaleString()," toman"]}),(0,t.jsx)("button",{type:"button",className:"btn btn-xs btn-outline border-white/30 text-white mt-2",onClick:()=>E(e.id),children:"Reorder"})]},e.id))}):(0,t.jsx)("p",{className:"text-sm text-white/60 mt-2",children:"No orders yet."}):(0,t.jsx)("p",{className:"text-sm text-white/60 mt-2",children:"Sign in to view order history."})]})]})]})}export{L as default};
