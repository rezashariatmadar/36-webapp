import{b as o}from"./chunk-3ESRGU4J.js";import{b as v,c as M,d as _}from"./chunk-DZ4QUUKD.js";var s=v(M());var t=v(_());function J({me:c}){let[x,A]=(0,s.useState)([]),[N,U]=(0,s.useState)([]),[u,D]=(0,s.useState)(""),[y,w]=(0,s.useState)([]),[g,k]=(0,s.useState)([]),[O,C]=(0,s.useState)(!1),[r,d]=(0,s.useState)(!1),[P,a]=(0,s.useState)(""),[S,i]=(0,s.useState)(""),b=!!(c?.user?.roles?.is_admin||c?.user?.roles?.is_barista),E=!!c?.user?.roles?.is_admin,B=async()=>{let[e,n]=await Promise.all([o("/api/cafe/staff/orders/"),o("/api/cafe/staff/menu-items/")]);A(e.orders||[]),U(n.items||[])},p=async()=>{if(!E){k([]);return}let e=await o("/api/auth/staff/users/?page=1&page_size=100");k(e.results||e||[])},l=async()=>{C(!0),a(""),i("");try{await Promise.all([B(),p()])}catch(e){a(e.message)}finally{C(!1)}};(0,s.useEffect)(()=>{b&&l()},[b]);let m=async(e,n)=>{a(""),i("");try{await o(`/api/cafe/staff/orders/${e}/status/`,{method:"POST",body:JSON.stringify({status:n})}),await l(),i("Order status updated.")}catch(h){a(h.message)}},I=async e=>{a(""),i("");try{await o(`/api/cafe/staff/orders/${e}/toggle-payment/`,{method:"POST"}),await l(),i("Payment state updated.")}catch(n){a(n.message)}},L=async e=>{a(""),i("");try{await o(`/api/cafe/staff/menu-items/${e}/toggle-availability/`,{method:"POST"}),await l(),i("Menu availability updated.")}catch(n){a(n.message)}},T=async()=>{if(!u.trim()){w([]);return}a("");try{let e=await o(`/api/cafe/staff/customer-lookup/?q=${encodeURIComponent(u.trim())}`);w(e.customers||[])}catch(e){a(e.message)}},$=async e=>{a(""),i(""),d(!0);try{await o(`/api/auth/staff/users/${e}/status/`,{method:"PATCH",body:JSON.stringify({})}),await p(),i("User status updated.")}catch(n){a(n.message)}finally{d(!1)}},f=async(e,n)=>{a(""),i(""),d(!0);try{await o(`/api/auth/staff/users/${e}/role/`,{method:"PATCH",body:JSON.stringify({role:n})}),await p(),i("User role updated.")}catch(h){a(h.message)}finally{d(!1)}};return c.authenticated?b?(0,t.jsxs)("section",{className:"spa-grid spa-grid-2",children:[(0,t.jsxs)("div",{className:"spa-card p-5 md:p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"Active Orders"}),(0,t.jsx)("button",{type:"button",className:"btn btn-sm btn-outline border-white/30 text-white",onClick:l,disabled:O,children:"Refresh"})]}),P?(0,t.jsx)("div",{className:"alert alert-error mt-4",children:P}):null,S?(0,t.jsx)("div",{className:"alert alert-success mt-4",children:S}):null,(0,t.jsx)("div",{className:"mt-4 space-y-3",children:x.length?x.map(e=>(0,t.jsxs)("div",{className:"spa-card p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsxs)("span",{children:["Order #",e.id]}),(0,t.jsx)("span",{children:e.status})]}),(0,t.jsx)("div",{className:"text-xs text-white/70 mt-1",children:e.customer?`${e.customer.full_name||e.customer.phone_number}`:"Walk-in guest"}),(0,t.jsxs)("div",{className:"text-xs text-white/70",children:["Total: ",(e.total_price||0).toLocaleString()," toman"]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 mt-3",children:[(0,t.jsx)("button",{type:"button",className:"btn btn-xs btn-outline border-white/30 text-white",onClick:()=>m(e.id,"PREPARING"),children:"Preparing"}),(0,t.jsx)("button",{type:"button",className:"btn btn-xs btn-outline border-white/30 text-white",onClick:()=>m(e.id,"READY"),children:"Ready"}),(0,t.jsx)("button",{type:"button",className:"btn btn-xs btn-outline border-white/30 text-white",onClick:()=>m(e.id,"DELIVERED"),children:"Delivered"}),(0,t.jsx)("button",{type:"button",className:"btn btn-xs btn-outline border-white/30 text-white",onClick:()=>m(e.id,"CANCELLED"),children:"Cancel"}),(0,t.jsx)("button",{type:"button",className:"btn btn-xs btn-primary",onClick:()=>I(e.id),children:e.is_paid?"Mark Unpaid":"Mark Paid"})]})]},e.id)):(0,t.jsx)("p",{className:"text-sm text-white/60",children:"No active orders."})})]}),(0,t.jsxs)("aside",{className:"spa-grid",children:[(0,t.jsxs)("div",{className:"spa-card p-5",children:[(0,t.jsx)("h2",{className:"text-lg font-bold",children:"Menu Stock"}),(0,t.jsx)("div",{className:"mt-3 space-y-2 max-h-80 overflow-auto pr-1",children:N.length?N.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm gap-2",children:[(0,t.jsx)("span",{className:"truncate",children:e.name}),(0,t.jsx)("button",{type:"button",className:"btn btn-xs btn-outline border-white/30 text-white",onClick:()=>L(e.id),children:e.is_available?"Disable":"Enable"})]},e.id)):(0,t.jsx)("p",{className:"text-sm text-white/60",children:"No menu items found."})})]}),(0,t.jsxs)("div",{className:"spa-card p-5",children:[(0,t.jsx)("h2",{className:"text-lg font-bold",children:"Customer Lookup"}),(0,t.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,t.jsx)("input",{className:"input input-bordered flex-1 bg-white/5 border-white/20 text-white",value:u,onChange:e=>D(e.target.value),placeholder:"Phone or name"}),(0,t.jsx)("button",{type:"button",className:"btn btn-outline border-white/30 text-white",onClick:T,children:"Search"})]}),(0,t.jsx)("div",{className:"mt-3 space-y-2",children:y.length?y.map(e=>(0,t.jsxs)("div",{className:"spa-card p-3 text-sm",children:[(0,t.jsx)("div",{children:e.full_name||"-"}),(0,t.jsx)("div",{className:"text-white/70",children:e.phone_number})]},e.id)):(0,t.jsx)("p",{className:"text-sm text-white/60",children:"No results."})})]}),E?(0,t.jsxs)("div",{className:"spa-card p-5",children:[(0,t.jsx)("h2",{className:"text-lg font-bold",children:"Platform Users"}),(0,t.jsx)("div",{className:"mt-3 space-y-2 max-h-96 overflow-auto pr-1",children:g.length?g.map(e=>(0,t.jsxs)("div",{className:"spa-card p-3 text-sm",children:[(0,t.jsx)("div",{className:"font-medium",children:e.full_name||"-"}),(0,t.jsx)("div",{className:"text-white/70",children:e.phone_number}),(0,t.jsxs)("div",{className:"text-white/70",children:["Role: ",e.role||"Unassigned"]}),(0,t.jsxs)("div",{className:"text-white/70",children:["Status: ",e.is_active?"Active":"Inactive"]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[(0,t.jsx)("button",{type:"button",className:"btn btn-xs btn-outline border-white/30 text-white",onClick:()=>f(e.id,"Admin"),disabled:r,children:"Admin"}),(0,t.jsx)("button",{type:"button",className:"btn btn-xs btn-outline border-white/30 text-white",onClick:()=>f(e.id,"Barista"),disabled:r,children:"Barista"}),(0,t.jsx)("button",{type:"button",className:"btn btn-xs btn-outline border-white/30 text-white",onClick:()=>f(e.id,"Customer"),disabled:r,children:"Customer"}),(0,t.jsx)("button",{type:"button",className:"btn btn-xs btn-primary",onClick:()=>$(e.id),disabled:r,children:e.is_active?"Deactivate":"Activate"})]})]},e.id)):(0,t.jsx)("p",{className:"text-sm text-white/60",children:"No users found."})})]}):null]})]}):(0,t.jsxs)("section",{className:"spa-card p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"Staff Dashboard"}),(0,t.jsx)("p",{className:"text-white/70 mt-2",children:"This section is restricted to Barista and Admin roles."})]}):(0,t.jsxs)("section",{className:"spa-card p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"Staff Dashboard"}),(0,t.jsx)("p",{className:"text-white/70 mt-2",children:"Sign in with a staff account to access this page."})]})}export{J as default};
